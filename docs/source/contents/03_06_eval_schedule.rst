.. include:: definition.txt

.. raw:: latex

    \clearpage

========================================================================================================================
スケジュール
========================================================================================================================

------------------------------------------------------------------------------------------------------------------------
1 はじめに
------------------------------------------------------------------------------------------------------------------------

本節では、スケジュールの指定の仕方について定義する。

スケジュールは室ごとに設定される。

スケジュールの種類は、居住人数に依存しないスケジュール（例えば非居室など）と居住人数に依存するスケジュールがある。

居住人数に依存するスケジュールを取得する場合、居住人数の指定の仕方は次の2種類ある。
この指定は、住宅全体で統一した1つの方法を決める必要がある。（室ごとに指定の仕方を変えることはできない。）
    
    a. 1人・2人・3人・4人の中から居住人数を直接指定する方法
    b. 床面積から仮想的な居住人数を計算する方法

「1人・2人・3人・4人の中から居住人数を直接指定する方法」を採用する場合、本節の計算は次の値を必要とする。

    1. 居住人数
    2. 室 |i| の床面積 :math:`A_{f,i}`, |m2|
    3. 室 |i| の使用するスケジュールの名称

「床面積から仮想的な居住人数を計算する方法」を採用する場合、本節の計算は次の値を必要とする。

    1. 室 |i| の床面積 :math:`A_{f,i}`, |m2|
    2. 室 |i| の使用するスケジュールの名称

また、使用するスケジュールは1日単位で別途設定しておく必要がある（後述）。

本節で示す計算の結果、次の値が得られる。

    1. ステップ |n| における室 |i| の人体発熱を除く内部発熱, :math:`q_{gen,i,n}`, W
    2. ステップ |n| における室 |i| の人体発湿を除く内部発湿, :math:`X_{gen,i,n}`, kg / s
    3. ステップ |n| における室 |i| の局所換気量, :math:`V_{mec,vent,local,i,n}`, |m3| / s
    4. ステップ |n| における室 |i| の在室人数, :math:`n_{hum,i,n}`, 人
    5. ステップ |n| における室 |i| の空調需要, :math:`r_{AC,demand,i,n}`, -
    6. ステップ |n| における室 |i| の運転モード, :math:`T_{operation_mode,i,n}`, -

ステップ |n| における室 |i| の空調需要, :math:`r_{AC,demand,i,n}` は、
ステップ |n| の時間間隔に対してどの程度の割合運転を行うのかを表す係数であり、0以上1以下の値である。
ステップ |n| における室 |i| の運転モード, :math:`T_{operation_mode,i,n}` は、
運転モードを表し、0以上の整数で表される。
運転モード「0」は、運転しないを表し、それ以外の運転モードは別途定義される。
ここで運転モードは、本節の外で自由に定義することができるが、
例えば制御を行うパラメータ（室温・作用温度・PMVなど）とその目標値（室温の場合は設定温度）などである。
なお、ここで定める運転モードは、暖房・冷房の区別は無いので、暖房の場合の挙動と冷房の場合の挙動をセットで外部で定義する必要がある。

------------------------------------------------------------------------------------------------------------------------
2 使用するスケジュール
------------------------------------------------------------------------------------------------------------------------

使用スケジュールは居住人数ごとに（ただし、居住人数に依存する使用スケジュールの場合のみ）及びスケジュールパターンごとに1日単位で以下の値を定める必要がある。

    1. 居住人数
    2. 機器発熱, W
    3. 照明発熱, W
    4. 調理発熱, W
    5. 調理発湿, kg / s
    6. 局所換気量, |m3| / s
    7. 運転パターン

例えば、15分間隔で指定する場合はこれらの値が96個必要である。

スケジュールパターンは「平日」「休日外出」「休日在宅」の3種類のパターンが存在する。

使用スケジュールの指定方法は json 形式で指定する。

居住人数に依存するスケジュールの場合

.. code-block::

    {
        "4": {
            "Weekday": {
                "number_of_people": [0, 0, ..., 0],
                "heat_generation_appliances": [135, 135, ..., 135],
                "heat_generation_lighting": [0, 0, ..., 0],
                "heat_generation_cooking": [0, 0, ..., 0],
                "vapor_generation_cooking": [0, 0, ..., 0],
                "local_vent_amount": [0, 0, ..., 0],
                "is_temp_limit_set": [0, 0, ..., 0]
            },
            "Holiday_In": {
                "number_of_people": [0, 0, ..., 0],
                ...
            },
            "Holiday_Out": {
                "number_of_people": [0, 0, ..., 0],
                ...
            }
        },
        "3": {
            "Weekday": {
                ...
            },
            "Holiday_In": {
                ...
            },
            "Holiday_Out": {
                ...
            }
        },
        "2": {
            "Weekday": {
                ...
            },
            "Holiday_In": {
                ...
            },
            "Holiday_Out": {
                ...
            }
        },
        "1": {
            "Weekday": {
                ...
            },
            "Holiday_In": {
                ...
            },
            "Holiday_Out": {
                ...
            }
        }
    }

居住人数に依存しないスケジュールの場合

.. code-block::
    
    {
        "const": {
            "Weekday": {
                "number_of_people": [0, 0, ..., 0],
                "heat_generation_appliances": [135, 135, ..., 135],
                "heat_generation_lighting": [0, 0, ..., 0],
                "heat_generation_cooking": [0, 0, ..., 0],
                "vapor_generation_cooking": [0, 0, ..., 0],
                "local_vent_amount": [0, 0, ..., 0],
                "is_temp_limit_set": [0, 0, ..., 0]
            },
            "Holiday_In": {
                "number_of_people": [0, 0, ..., 0],
                ...
            },
            "Holiday_Out": {
                "number_of_people": [0, 0, ..., 0],
                ...
            }
        },
    }


------------------------------------------------------------------------------------------------------------------------
3 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける値
------------------------------------------------------------------------------------------------------------------------

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける人体発熱を除く内部発熱 :math:`q_{gen,i,d,n_d}` は次式で表される。

.. math::
    :nowrap:

    \begin{align*}
        q_{gen,i,d,n_d} = q_{gen,app,i,d,n_d} + q_{gen,ckg,i,d,n_d} + q_{gen,lght,i,d,n_d} \cdot A_{f,i}
        \tag{1}
    \end{align*}

:math:`q_{gen,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける人体発熱を除く内部発熱, W

:math:`\hat{q}_{gen,app,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける機器発熱, W

:math:`\hat{q}_{gen,ckg,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける調理発熱, W

:math:`\hat{q}_{gen,lght,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける床面積あたりの照明発熱, W / |m2|

:math:`A_{f,i}` : 室 |i| の床面積, |m2|

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける人体発湿を除く内部発湿 :math:`X_{gen,i,d,n_d}` は次式で表される。

.. math::
    :nowrap:

    \begin{align*}
        X_{gen,i,d,n_d} = \frac{ X_{gen,ckg,i,d,n_d} }{1000 \cdot 3600}
        \tag{2}
    \end{align*}

:math:`X_{gen,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける人体発湿を除く内部発湿, kg / s

:math:`\hat{X}_{gen,ckg,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける調理発湿, g / h

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける局所換気量 :math:`V_{mec,vent,local,i,d,n_d}` は次式で表される。

.. math::
    :nowrap:

    \begin{align*}
        V_{mec,vent,local,i,d,n_d} = \frac{ \hat{V}_{mec,vent,local,i,d,n_d} }{3600}
        \tag{3}
    \end{align*}

:math:`V_{mec,vent,local,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける局所換気量, |m3| / s

:math:`\hat{V}_{mec,vent,local,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける局所換気量, |m3| / h

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける在室人数 :math:`n_{hum,i,d,n_d}` は次式で表される。

.. math::
    :nowrap:

    \begin{align*}
        n_{hum,i,d,n_d} = \hat{n}_{hum,i,d,n_d}
        \tag{4}
    \end{align*}

:math:`n_{hum,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける在室人数, 人

:math:`\hat{n}_{hum,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける在室人数, 人

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける空調需要 :math:`r_{AC,demand,i,d,n_d}` は次式で表される。

.. math::
    :nowrap:

    \begin{align*}
        r_{AC,demand,i,d,n_d} = \begin{cases}
            1 & ( \hat{T}_{operation_mode,i,d,n_d} \gt 0 ) \\
            0 & ( \hat{T}_{operation_mode,i,d,n_d} = 0 )
        \end{cases}
        \tag{5}
    \end{align*}

:math:`r_{AC,demand,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける空調需要, -

:math:`\hat{T}_{operation_mode,i,d,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける運転モード

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける運転モード :math:`T_{operation_mode,i,d,n_d}` は次式で表される。

.. math::
    :nowrap:

    \begin{align*}
        T_{operation_mode,i,n_d} = \hat{T}_{operation_mode,i,n_d}
        \tag{6}
    \end{align*}

:math:`T_{operation_mode,i,n_d}` : 日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける運転モード

ここで、次の値に関し、居住人数（スケジュールが居住人数に依存する場合のみ）及びスケジュールパターンに応じて、指定されたスケジュールの名称ファイル内に記述された json の Key との対応関係を示す。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける機器発熱 :math:`\hat{q}_{gen,app,i,d,n_d}` は、"heat_generation_appliances" で定義される。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける調理発熱 :math:`\hat{q}_{gen,ckg,i,d,n_d}` は、"heat_generation_cooking" で定義される。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける床面積あたりの照明発熱 :math:`\hat{q}_{gen,lght,i,d,n_d}` は、"heat_generation_lighting" で定義される。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける調理発湿 :math:`\hat{X}_{gen,ckg,i,d,n_d}` は、"vapor_generation_cooking" で定義される。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける局所換気量 :math:`\hat{V}_{mec,vent,local,i,d,n_d}` は、"local_vent_amount" で定義される。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける在室人数 :math:`\hat{n}_{hum,i,d,n_d}` は、"number_of_people" で定義される。

日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける運転モード :math:`\hat{T}_{operation_mode,i,n_d}` は、"is_temp_limit_set" で定義される。


------------------------------------------------------------------------------------------------------------------------
3 ステップ |n| における室 |i| の特定の居住人数における値
------------------------------------------------------------------------------------------------------------------------

ステップ |n| における室 |i| の特定の居住人数における値（
ステップ |n| における室 |i| の特定の居住人数における人体発熱を除く内部発熱 :math:`q_{gen,i,n}` ・
ステップ |n| における室 |i| の特定の居住人数における人体発湿を除く内部発湿 :math:`X_{gen,i,n}` ・
ステップ |n| における室 |i| の特定の居住人数における局所換気量 :math:`V_{mec,vent,local,i,n}` ・
ステップ |n| における室 |i| の特定の居住人数における在室人数 :math:`n_{hum,i,n}` ・
ステップ |n| における室 |i| の特定の居住人数における空調需要 :math:`r_{AC,demand,n}` ・
ステップ |n| における室 |i| の特定の居住人数における運転モード :math:`T_{operation_mode,n}` ）は、
日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける値を、
1年間1日ごとに定義されたスケジュールパターンに応じて作成する。

例えば、15分間隔の計算では、
日付 |d| のステップ :math:`n_d` における室 |i| の特定の居住人数・特定のスケジュールパターンにおける値は96個であり、
スケジュールパターン3種類分用意される。
これを、別途定義された1年間1日ごとに定義されたスケジュールパターンに応じてつなげていくため、最終的な値の個数は :math:`365 \times 96` になる。

1年間1日ごとに定義されたスケジュールパターンは次表により与えられる。

.. code-block:: python

    [
        "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", 
        "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", 
        "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "HI", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", 
        "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", 
        "W", "W", "HO", "HO", "HI", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", 
        "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", 
        "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "HI", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", 
        "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", 
        "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "HO", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", 
        "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "HI", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", 
        "W", "W", "HI", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "HI", "W", "HI", "HO", "W", "W", "W", "W", 
        "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HI", "HI", "W", "W", "W", "W", "W", "HI", "HO", "W", "W", "W", "W", "W", "HO", "HI"
    ]

ここで、"W"は「平日」、"HI"は「休日在宅」、"HO"は「休日外出」である。

------------------------------------------------------------------------------------------------------------------------
4 ステップ |n| における室 |i| の値
------------------------------------------------------------------------------------------------------------------------

居住人数を指定する場合は、指定された居住人数に応じてステップ |n| における室 |i| の値を採用する。

居住人数を指定しない場合は、居室 |i| の床面積 :math:`A_{f,i}` から居住人数を推定することになる。
その場合の居住人数は整数にならないため、スケジュールデータの何らかの合成方法が必要となる。

次の値については、居住人数に応じて按分する。

    - ステップ |n| における室 |i| の人体発熱を除く内部発熱 :math:`q_{gen,i,n}` ・
    - ステップ |n| における室 |i| の人体発湿を除く内部発湿 :math:`X_{gen,i,n}` ・
    - ステップ |n| における室 |i| の局所換気量 :math:`V_{mec,vent,local,i,n}` ・
    - ステップ |n| における室 |i| の在室人数 :math:`n_{hum,i,n}` ・
    - ステップ |n| における室 |i| の空調需要 :math:`r_{AC,demand,n}` ・

ここで按分とは、次式により表される。

.. math::
    :nowrap:

    \begin{align*}
        x_{i,n} = \begin{cases}
            x_{i,n,p} \mid_{p=1} & ( p \le 1 ) \\
            x_{i,n,p} \mid_{p=2} \cdot (p - 1) + x_{i,n,p} \mid_{p=1} \cdot (2 - p) & ( 1 < p \text{ and } p \le 2 ) \\
            x_{i,n,p} \mid_{p=3} \cdot (p - 2) + x_{i,n,p} \mid_{p=2} \cdot (3 - p) & ( 2 < p \text{ and } p \le 3 ) \\
            x_{i,n,p} \mid_{p=4} \cdot (p - 3) + x_{i,n,p} \mid_{p=3} \cdot (4 - p) & ( 3 < p \text{ and } p \le 4 ) \\
            x_{i,n,p} \mid_{p=4} & ( 4 < p )
        \end{cases}
        \tag{6}
    \end{align*}

:math:`x_{i,n}` : ステップ |n| における室 |i| の按分後のパラメータ
:math:`x_{i,n, p}` : ステップ |n| における室 |i| の居住人数 :math:`p` 人のパラメータ
:math:`p` : 居住人数


ステップ |n| における室 |i| の特定の居住人数における運転モード :math:`T_{operation_mode,n}` ）は、居住人数に応じてその外側の値を比較し大きい方の値を採用する。

つまり、以下の操作を行う。

.. math::
    :nowrap:

    \begin{align*}
        x_{i,n} = \begin{cases}
            x_{i,n,p} \mid_{p=1} & ( p \le 1 ) \\
            \max( x_{i,n,p} \mid_{p=1}, x_{i,n,p} \mid_{p=2} ) & ( 1 < p \text{ and } p \le 2 ) \\
            \max( x_{i,n,p} \mid_{p=2}, x_{i,n,p} \mid_{p=3} ) & ( 2 < p \text{ and } p \le 3 ) \\
            \max( x_{i,n,p} \mid_{p=3}, x_{i,n,p} \mid_{p=4} ) & ( 3 < p \text{ and } p \le 4 ) \\
            x_{i,n,p} \mid_{p=4} & ( 4 < p )
        \end{cases}
        \tag{7}
    \end{align*}

:math:`x_{i,n}` : ステップ |n| における室 |i| の比較後のパラメータ
:math:`x_{i,n, p}` : ステップ |n| における室 |i| の居住人数 :math:`p` 人のパラメータ
:math:`p` : 居住人数

